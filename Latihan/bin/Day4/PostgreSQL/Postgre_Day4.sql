-- buat database
CREATE DATABASe bukopin

-- BUAT TABLE
CREATE TABLE PEGAWAI(
	ID_PEGAWAI INTEGER PRIMARY KEY,
	UMUR INTEGER,
	NAMA_PEGAWAI TEXT
)

-- RENAME TABLE
ALTER TABLE PEGAWAI2 RENAME TO PEGAWAI

-- CREATE TABLE FIME
CREATE TABLE FILM(
	KD_FILM TEXT PRIMARY KEY,
	NM_FILM TEXT,
	GENRE TEXT,
	ARTIS TEXT,
	PRODUSER TEXT,
	PENDAPATAN INTEGER,
	NOMINASI INTEGER
)

-- INSERT DATA PEGAWAI
INSERT INTO PEGAWAI(ID_PEGAWAI,UMUR,NAMA_PEGAWAI) VALUES(1,26,'AKBAR F')
INSERT INTO PEGAWAI VALUES(2,24,'SHIENA A')
INSERT INTO PEGAWAI(ID_PEGAWAI) VALUES(3)
INSERT INTO PEGAWAI(UMUR) VALUES(24)
INSERT INTO PEGAWAI VALUES(4,24,'YASMIN A')

-- UPDATE DATA PEGAWAI
UPDATE PEGAWAI SET UMUR = 25, NAMA_PEGAWAI='JANE' WHERE ID_PEGAWAI=3


-- DELETE DATA PEGAWAI
DELETE FROM PEGAWAI WHERE ID_PEGAWAI=3

SELECT * FROM PEGAWAI

SELECT 100*3 AS "HASIL PERKALIAN"

SELECT NAMA_PEGAWAI, UMUR*2 AS "HASIL KALI" FROM PEGAWAI WHERE ID_PEGAWAI=2

SELECT * FROM PEGAWAI ORDER BY UMUR DESC

SELECT DISTINCT(UMUR) FROM PEGAWAI

SELECT * FROM PEGAWAI WHERE UMUR = 27
SELECT * FROM PEGAWAI WHERE ID_PEGAWAI IN(1,3,4)

SELECT * FROM PEGAWAI WHERE NAMA_PEGAWAI LIKE 'Y%'
SELECT * FROM PEGAWAI WHERE NAMA_PEGAWAI LIKE '%E%'

SELECT COUNT(NAMA_PEGAWAI) FROM PEGAWAI
SELECT MAX(UMUR) FROM PEGAWAI

SELECT * FROM FILM

INSERT INTO public.film VALUES ('F001', 'IRON MAN', 'G001', 'A001', 'PD01', 2000000000, 3);
INSERT INTO public.film VALUES ('F002', 'IRON MAN 2', 'G001', 'A001', 'PD01', 1800000000, 2);
INSERT INTO public.film VALUES ('F003', 'IRON MAN 3', 'G001', 'A001', 'PD01', 1200000000, 0);
INSERT INTO public.film VALUES ('F004', 'AVENGER:CIVIL WAR', 'G001', 'A001', 'PD01', 2000000000, 1);
INSERT INTO public.film VALUES ('F005', 'SPIDERMAN HOMCOMING', 'G001', 'A001', 'PD01', 1300000000, 0);
INSERT INTO public.film VALUES ('F006', 'THE RAID', 'G001', 'A004', 'PD03', 800000000, 5);
INSERT INTO public.film VALUES ('F007', 'FAST & FURIOUS', 'G001', 'A004', 'PD05', 830000000, 2);
INSERT INTO public.film VALUES ('F008', 'HABIBI DAN AINUN', 'G004', 'A005', 'PD03', 670000000, 4);
INSERT INTO public.film VALUES ('F009', 'POLICE STORY', 'G001', 'A003', 'PD02', 700000000, 3);
INSERT INTO public.film VALUES ('F010', 'POLICE STORY 2', 'G001', 'A003', 'PD02', 710000000, 1);
INSERT INTO public.film VALUES ('F011', 'POLICE STORY 3', 'G001', 'A003', 'PD02', 615000000, 0);
INSERT INTO public.film VALUES ('F012', 'RUSH HOUR', 'G003', 'A003', 'PD05', 695000000, 2);
INSERT INTO public.film VALUES ('F013', 'KUNGFU PANDA', 'G003', 'A003', 'PD05', 923000000, 5);

-- 1 NAMA FILM DAN NOMINASI DARI NOMINASI TERBESAR
SELECT NM_FILM, NOMINASI FROM FILM ORDER BY NOMINASI DESC

-- 2 NAMA FILM DAN PENDAPATAN DARI PENDAPATAN TERKECIL
SELECT NM_FILM, PENDAPATAN FROM FILM ORDER BY PENDAPATAN ASC

-- 3 NAMA FILM DAN NOMINASI YG TIDAK DAPAT NOMINASI
SELECT NM_FILM, NOMINASI FROM FILM WHERE NOMINASI = 0

-- 4 NAMA FILM DAN NOMINASI YANG PALING BANYAK MENDAPATKAN NOMINASI
SELECT NM_FILM, NOMINASI FROM FILM WHERE NOMINASI = (
	SELECT MAX(NOMINASI) FROM FILM
)

-- 5 NAMA FILM DAN PENDAPATAN TERBESAR
SELECT NM_FILM, PENDAPATAN FROM FILM WHERE PENDAPATAN = (
	SELECT MAX(PENDAPATAN) FROM FILM
)

-- 6 NAMA FILM DAN PENDAPATAN TERKECIL
SELECT NM_FILM, PENDAPATAN FROM FILM WHERE PENDAPATAN = (
	SELECT MIN(PENDAPATAN) FROM FILM
)

-- 7 RATA-RATA PENDAPATAN FILM KESELURUHAN
SELECT AVG(PENDAPATAN) FROM FILM
SELECT CEILING(AVG(PENDAPATAN)) FROM FILM --PEMBULATAN
SELECT ROUND(AVG(PENDAPATAN)::NUMERIC,2) FROM FILM --2 ANGKA DI BELAKANG KOMA


-- 8 RATA-RATA NOMINASI FILM KESELURUHAN
SELECT AVG(NOMINASI) FROM FILM

-- 9 NAMA FILM YANG HURUF DEPANNYA P
SELECT NM_FILM FROM FILM WHERE NM_FILM LIKE 'P%'
SELECT NM_FILM FROM FILM WHERE LOWER(NM_FILM) LIKE LOWER('P%')

-- 10 NAMA FILM YAG HURUF TERAKHIRNYA H => DIGANTI N AJA
SELECT NM_FILM FROM FILM WHERE NM_FILM LIKE '%N'
SELECT NM_FILM FROM FILM WHERE LOWER(NM_FILM) LIKE LOWER('%N')

-- 11 NAMA FILM YANG MENGANDUNG HURUF D
SELECT NM_FILM FROM FILM WHERE NM_FILM LIKE '%D%'
SELECT NM_FILM FROM FILM WHERE LOWER(NM_FILM) LIKE LOWER('%D%')

-- 12 NAMA FILM DENGAN PENDAPATAN TERKECIL YG MENGANDUNG HURUF O
SELECT NM_FILM,PENDAPATAN FROM FILM WHERE PENDAPATAN = (
	SELECT MIN(PENDAPATAN) FROM FILM
) AND (NM_FILM LIKE '%O%' OR LOWER(NM_FILM) LIKE LOWER('%O'))

SELECT NM_FILM,PENDAPATAN FROM FILM WHERE LOWER(NM_FILM) LIKE '%o%'
AND PENDAPATAN = (SELECT MIN(PENDAPATAN) FROM FILM WHERE LOWER(NM_FILM) LIKE '%o%')

-- 13 NAMA FILM DENGAN PENDAPATAN TERBESAR YANG MENGANDUNG HURUF O
SELECT NM_FILM FROM FILM WHERE PENDAPATAN = (
	SELECT MAX(PENDAPATAN) FROM FILM
) AND (NM_FILM LIKE '%O%' OR LOWER(NM_FILM) LIKE LOWER('%O'))


--INCREMENT
SELECT*FROM PEGAWAI

CREATE TABLE MAHASISWA(
ID SERIAL PRIMARY KEY,
	NAMA TEXT
)
CREATE TABLE PEGAWAI3(
	ID_PEGAWAI SERIAL PRIMARY KEY,
	UMUR INTEGER,
	NAMA_PEGAWAI TEXT
)

ALTER TABLE PEGAWAI3 ALTER COLUMN ID_PEGAWAI ADD GENERATED BY DEFAULT AS IDENTITY

ALTER SEQUENCE PEGAWAI3_IDPEGAWAI_SEQ RESTART WITH 7
INSERT INTO PEGAWAI(UMUR,NAMA_PEGAWAI)VALUES(23,'IWAN')

CREATE TABLE public.kota (
    id integer NOT NULL,
    nama text,
    id_propinsi integer
)

Delete from kota
Select*from kota

INSERT INTO kota (id, nama, id_propinsi) VALUES (1, 'Jakarta', 1);
INSERT INTO kota (id, nama, id_propinsi) VALUES (2, 'Bandung', 2);
INSERT INTO kota (id, nama, id_propinsi) VALUES (3, 'Sumedang', 2);
INSERT INTO kota (id, nama, id_propinsi) VALUES (4, 'Makasar', 4);
INSERT INTO kota (id, nama, id_propinsi) VALUES (5, 'Surabaya', 5);
INSERT INTO kota (id, nama, id_propinsi) VALUES (6, 'Medan', 6);

CREATE TABLE propinsi (
    id integer NOT NULL,
    nama text
);

INSERT INTO propinsi (id, nama) VALUES (1, 'DKI Jakarta');
INSERT INTO propinsi (id, nama) VALUES (2, 'Jawa Barat');
INSERT INTO propinsi (id, nama) VALUES (3, 'Papua Barat');
INSERT INTO propinsi (id, nama) VALUES (4, 'Sulawesi Selatan');
INSERT INTO propinsi (id, nama) VALUES (5, 'Jawa Timur');

SELECT*FROM PROPINSI;

-- INNER JOIN
SELECT A.NAMA, B.NAMA FROM KOTA A JOIN PROPINSI B
ON A.ID=B.ID;

-- LEFT JOIN
SELECT A.NAMA, B.NAMA FROM KOTA A LEFT JOIN PROPINSI B
ON A.ID=B.ID;

-- RIGHT JOIN
SELECT A.NAMA, B.NAMA FROM KOTA A RIGHT JOIN PROPINSI B
ON A.ID=B.ID;

-- OUTER JOIN
SELECT A.NAMA, B.NAMA FROM KOTA A FULL OUTER JOIN PROPINSI B
ON A.ID=B.ID;

--WILD
SELECT A.NAMA, B.NAMA FROM KOTA A,PROPINSI B WHERE A.ID=B.ID;

CREATE TABLE public.produser (
    kd_produser character varying(5) NOT NULL,
    nm_produser character varying(50),
    international character varying(10)
);

INSERT INTO public.produser (kd_produser, nm_produser, international) VALUES ('PD01', 'MARVEL', 'YA');
INSERT INTO public.produser (kd_produser, nm_produser, international) VALUES ('PD02', 'HONGKONG CINEMA', 'YA');
INSERT INTO public.produser (kd_produser, nm_produser, international) VALUES ('PD03', 'RAPI FILM', 'TIDAK');
INSERT INTO public.produser (kd_produser, nm_produser, international) VALUES ('PD04', 'PARKIT FILM', 'TIDAK');
INSERT INTO public.produser (kd_produser, nm_produser, international) VALUES ('PD05', 'PARAMOUNT PICTURE', 'YA');

CREATE TABLE public.negara (
    kd_negara character varying(5) NOT NULL,
    nm_negara character varying(50)
);

INSERT INTO public.negara (kd_negara, nm_negara) VALUES ('AS', 'AMERIKA SERIKAT');
INSERT INTO public.negara (kd_negara, nm_negara) VALUES ('HK', 'HONGKONG');
INSERT INTO public.negara (kd_negara, nm_negara) VALUES ('ID', 'INDONESIA');
INSERT INTO public.negara (kd_negara, nm_negara) VALUES ('IN', 'INDIA');

CREATE TABLE public.genre (
    kd_genre character varying(5) NOT NULL,
    nm_genre character varying(50)
);

INSERT INTO public.genre (kd_genre, nm_genre) VALUES ('G001', 'ACTION');
INSERT INTO public.genre (kd_genre, nm_genre) VALUES ('G002', 'HORROR');
INSERT INTO public.genre (kd_genre, nm_genre) VALUES ('G003', 'COMEDY');
INSERT INTO public.genre (kd_genre, nm_genre) VALUES ('G004', 'DRAMA');
INSERT INTO public.genre (kd_genre, nm_genre) VALUES ('G005', 'THRILER');
INSERT INTO public.genre (kd_genre, nm_genre) VALUES ('G006', 'FICTION');

CREATE TABLE public.artis (
    kd_artis character varying(5) NOT NULL,
    nm_artis character varying(50),
    jk character varying(10),
    bayaran integer,
    award integer,
    negara character varying(5)
);

INSERT INTO public.artis (kd_artis, nm_artis, jk, bayaran, award, negara) VALUES ('A001', 'ROBERT DOWNEY JR', 'PRIA', 1000000000, 2, 'AS');
INSERT INTO public.artis (kd_artis, nm_artis, jk, bayaran, award, negara) VALUES ('A003', 'JACKIE CHAN', 'PRIA', 1200000000, 7, 'HK');
INSERT INTO public.artis (kd_artis, nm_artis, jk, bayaran, award, negara) VALUES ('A004', 'JOE TASLIM', 'PRIA', 350000000, 1, 'ID');
INSERT INTO public.artis (kd_artis, nm_artis, jk, bayaran, award, negara) VALUES ('A005', 'CHELSEA ISLAN', 'WANITA', 300000000, 0, 'ID');
INSERT INTO public.artis (kd_artis, nm_artis, jk, bayaran, award, negara) VALUES ('A002', 'ANGELINA JOLIE', 'WANITA', 700000000, 1, 'AS');

SELECT*FROM GENRE
SELECT*FROM ARTIS
SELECT*FROM NEGARA
SELECT*FROM FILM

-- 14 TAMPILKAN NAMA FILM DAN ARTISNYA
SELECT A.NM_FILM,B.NM_ARTIS FROM FILM A JOIN ARTIS B ON A.ARTIS=B.KD_ARTIS;

-- 15 TAMPILKAN FILM YANG ARTISNYA BERASAL DARI HONGKONG
SELECT NM_FILM,NM_NEGARA FROM FILM A JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS JOIN NEGARA C ON
B.NEGARA = C.KD_NEGARA

-- 16 TAMPILKAN NAMA FILM YG ARTISNYA BERASAL DR NEGARA YG TIDAK MENGANDUNG HURUF 'O'
SELECT NM_FILM, NM_NEGARA FROM FILM A JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS JOIN NEGARA C ON
B.NEGARA = KD_NEGARA
WHERE LOWER(NM_NEGARA) NOT LIKE LOWER ('%o%')

-- 17 TAMPILKAN NAMA FILM DAN ARTIS YANG MEMILIKI AWARD TERBANYAK
SELECT A.NM_FILM, B.NM_ARTIS FROM FILM A JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS WHERE B.AWARD = (SELECT MAX(AWARD)FROM ARTIS C JOIN FILM D ON D.ARTIS=C.KD_ARTIS)

--18 TAMPILKAN NAMA FILM DENGAN ARTIS BAYARAN TERENDAH
SELECT A.NM_FILM, B.NM_ARTIS FROM FILM A JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS WHERE B.BAYARAN = (SELECT MIN(BAYARAN)FROM ARTIS C JOIN FILM D ON D.ARTIS=C.KD_ARTIS)

--19 TAMPILKAN NAMA ARTIS YG TIDAK PERNAH BERMAIN FILM
SELECT A.KD_FILM, A.NM_FILM, B.NM_ARTIS FROM FILM A RIGHT JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS WHERE A.NM_FILM IS NULL 

SELECT COUNT(A.NM_FILM) AS "JUMLAH FILM", B.NM_ARTIS FROM FILM A RIGHT JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS GROUP BY B.NM_ARTIS HAVING COUNT(A.NM_FILM)=0

--20 TAMPILKAN NAMA ARTIS YG BERMAIN FILM DENGAN GENRE DRAMA
SELECT A.NM_FILM, C.NM_GENRE AS "GENRE FILM",B.NM_ARTIS FROM FILM A JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS JOIN GENRE C ON A.GENRE=C.KD_GENRE WHERE C.NM_GENRE LIKE '%DRAMA%'

--21 TAMPILKAN NAMA ARTIS YG BERMAIN FILM DENGAN GENRE HORROR
SELECT A.NM_FILM, C.NM_GENRE AS "GENRE FILM",B.NM_ARTIS FROM FILM A JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS JOIN GENRE C ON A.GENRE=C.KD_GENRE WHERE C.NM_GENRE LIKE '%HORROR%'

--22 TAMPILKAN NAMA FILM YG DIBINTANGI OLEH ARTIS YG HURUF DEPANNYA 'J'
SELECT A.NM_FILM, B.NM_ARTIS FROM FILM A JOIN ARTIS B ON
A.ARTIS = B.KD_ARTIS WHERE B.NM_ARTIS LIKE 'J%'


